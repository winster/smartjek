var Gpio = require('onoff').Gpio,
  a = new Gpio(23, 'in', 'both'),
  b = new Gpio(24, 'in', 'both');

a.watch(updateEncoder);
b.watch(updateEncoder);

var lastEncoded = 0;
var value = 0;

function updateEncoder() {
  updateGlobal(a.readSync(), b.readSync());
}

function updateGlobal(a, b) {
    const MSB = a;
    const LSB = b;

    console.log('MSB, LSB', MSB, LSB);

    const encoded = (MSB << 1) | LSB;
    const sum = (lastEncoded << 2) | encoded;

    if(sum == 0b1101 || sum == 0b0100 || sum == 0b0010 || sum == 0b1011) value++;
    if(sum == 0b1110 || sum == 0b0111 || sum == 0b0001 || sum == 0b1000) value--;

    lastEncoded = encoded;
}

// function updateEncoder() {
//   const MSB = a.readSync();
//   const LSB = b.readSync();
//
//   const encoded = (MSB << 1) | LSB;
//   const sum = (lastEncoded << 2) | encoded;
//
//   if(sum == 0b1101 || sum == 0b0100 || sum == 0b0010 || sum == 0b1011) value++;
//   if(sum == 0b1110 || sum == 0b0111 || sum == 0b0001 || sum == 0b1000) value--;
//
//   lastEncoded = encoded;
// }

console.log('listening');

setInterval(function () {
  // if (lastEncoded !== value) {
    console.log(value);
  // }
}, 100)
